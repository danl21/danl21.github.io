
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Interpolation Part 4: Spline interpolation &#8212; MT3510 Introduction to Mathematical Computing</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 4 Pure Mathematics: Graph Theory" href="../4_PureNotebooks/0intro.html" />
    <link rel="prev" title="Interpolation Part 3: Piecewise polynomial interpolation" href="Interpolation_Part3_PiecewisePolynomial.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MT3510 Introduction to Mathematical Computing</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to MT3510
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../diary.html">
   Module diary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../generic-guidance-23.html">
   Coursework submission guidance
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../1_IntroNotebooks/0intro.html">
   Chapter 1: The Fundamentals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/1%20Python%20and%20Jupyter%20Notebooks%20Basics.html">
     Python &amp; Jupyter
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/2%20Variables.html">
     Variables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/3%20Modules%20and%20Numpy.html">
     Modules and numpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/4%20Errors.html">
     Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/5%20Printing%20and%20Strings.html">
     Printing to the screen
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/6%20For%20Loops.html">
     For loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/7%20Nested%20For%20Loops.html">
     Nested
     <code class="docutils literal notranslate">
      <span class="pre">
       for
      </span>
     </code>
     loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/8%20Functions.html">
     Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/9%20Conditionals.html">
     Conditionals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/10%20While%20Loops.html">
     While loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/11%20Lists%20and%20Tuples.html">
     Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/12%20Arrays.html">
     Arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/13%20Slicing.html">
     Slicing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/14%20Floating%20Point%20Numbers.html">
     Floating point numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/15%20Sets%20and%20Dicts.html">
     Sets and Dicts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/16%20Types.html">
     Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/17%20Input%20and%20Files.html">
     Input and files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/18%20Plotting.html">
     Matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../1_IntroNotebooks/19%20Markdown%20and%20LaTeX.html">
     Markdown
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../2_CoreNotebooks/0intro.html">
   Chapter 2: Topics in Computational Mathematics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/1Computational_Thinking.html">
     Introduction to Computational Thinking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/2Interactivity.html">
     Interactivity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/3Sympy.html">
     SymPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/4Computational_Complexity.html">
     Introduction to Computational Complexity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/5GoodPractise1_Efficiency.html">
     Good practise in Python: Part 1 Efficiency
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/6GoodPractise2_Usability.html">
     Good practise in Python Part 2: Usability &amp; Style
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/7ComputationalGeometry.html">
     Computational Geometry
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../2_CoreNotebooks/8Introduction_to_Pandas.html">
     Introduction to Pandas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="0intro.html">
   Chapter 3 Applied Mathematics: Interpolation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Interpolation_Part1_Linear.html">
     Interpolation Part 1: Linear Interpolation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Interpolation_Part2_Polynomial.html">
     Interpolation Part 2: Polynomial interpolation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Interpolation_Part3_PiecewisePolynomial.html">
     Interpolation Part 3: Piecewise polynomial interpolation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Interpolation Part 4: Spline interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../4_PureNotebooks/0intro.html">
   Chapter 4 Pure Mathematics: Graph Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../5_StatsNotebooks/0intro.html">
   Chapter 5 Statistics:
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/3_AppliedNotebooks/Interpolation_Part4_CubicSpline.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/3_AppliedNotebooks/Interpolation_Part4_CubicSpline.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-brief-return-to-linear-interpolation-basis-functions">
   A brief return to linear interpolation: basis functions.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#splines-general-definition">
   Splines: General Definition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cubic-splines">
   Cubic Splines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-basis-approach">
     The basis approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-cubic-spline">
     General Cubic Spline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application">
     Application
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scipy-implementation">
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy
        </span>
       </code>
       implementation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Interpolation Part 4: Spline interpolation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-brief-return-to-linear-interpolation-basis-functions">
   A brief return to linear interpolation: basis functions.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#splines-general-definition">
   Splines: General Definition
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cubic-splines">
   Cubic Splines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-basis-approach">
     The basis approach
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#general-cubic-spline">
     General Cubic Spline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application">
     Application
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#scipy-implementation">
       <code class="docutils literal notranslate">
        <span class="pre">
         scipy
        </span>
       </code>
       implementation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="interpolation-part-4-spline-interpolation">
<h1>Interpolation Part 4: Spline interpolation<a class="headerlink" href="#interpolation-part-4-spline-interpolation" title="Permalink to this headline">#</a></h1>
<section id="a-brief-return-to-linear-interpolation-basis-functions">
<h2>A brief return to linear interpolation: basis functions.<a class="headerlink" href="#a-brief-return-to-linear-interpolation-basis-functions" title="Permalink to this headline">#</a></h2>
<p>In part 2 of this chapter we considered piecewise linear interpolation; given a set of <span class="math notranslate nohighlight">\(n\)</span> data points <span class="math notranslate nohighlight">\((x_k,y_k),\)</span> <span class="math notranslate nohighlight">\(k=0,1,...,n-1\)</span> that partition <span class="math notranslate nohighlight">\(x\in[a,b]\)</span> into subintervals <span class="math notranslate nohighlight">\([x_k,x_{l+1}]\)</span> where</p>
<div class="math notranslate nohighlight">
\[
a=x_0 &lt; x_1&lt;x2&lt;...&lt;x_{n-1}=b, 
\]</div>
<p>the interpolant for <span class="math notranslate nohighlight">\(x\in[x_k,x_{k+1}]\)</span> will be</p>
<div class="math notranslate nohighlight">
\[p_{1k}(x) = \frac{x-x_{k+1}}{x_k-x_{k+1}}y_k + \frac{x-x_k}{x_{k+1}-x_k}y_{k+1}.\]</div>
<p>The complete piecewise linear function is</p>
<div class="math notranslate nohighlight">
\[S_1(x) = \sum\limits_{k=0}^{n-1}p_{1k}(x).\]</div>
<p>Alternatively, this can be rewritten as</p>
<div class="math notranslate nohighlight">
\[S_1(x)=\sum_{k=0}^{n}f(x_k)\phi_k(x)\,,\]</div>
<p>where the <em>basis functions</em> <span class="math notranslate nohighlight">\(\phi_k\)</span> are defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\phi_k(x)= \begin{cases} \frac{x-x_{k+1}}{x_{k}-x_{k+1}} &amp; \;\; x_{k} \le x \le  x_{k+1}\\ 
\frac{x-x_{k-1}}{x_{k}-x_{k-1}} &amp; \;\;  x_{k-1} \le x \le  x_{k}\\
0 &amp; \;\; \textrm{elsewhere}.\end{cases}\end{split}\]</div>
<p>These basis functions are <em>hat</em> or <em>tent</em> functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">})</span>            <span class="c1"># Increase the font size to 14pt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the hat given the points -1,0,1</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x1</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">))</span>
    <span class="n">il</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x0</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x1</span><span class="p">))</span>
    <span class="n">y</span><span class="p">[</span><span class="n">il</span><span class="p">[:]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">il</span><span class="p">[:]]</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
    <span class="n">y</span><span class="p">[</span><span class="n">ir</span><span class="p">[:]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ir</span><span class="p">[:]]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\phi$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Interpolation_Part4_CubicSpline_2_0.png" src="../_images/Interpolation_Part4_CubicSpline_2_0.png" />
</div>
</div>
<p>Notice that</p>
<div class="math notranslate nohighlight">
\[\phi_k(x_{k-1})=0\;,\quad\phi_k(x_{k})=1\quad{\rm and}\quad\phi_k(x_{k+1})=0\;.\]</div>
<p>and <span class="math notranslate nohighlight">\(S_1(x)\)</span> is constrained to be continuous but may have discontinuities in <span class="math notranslate nohighlight">\(S_1'(x).\)</span></p>
<p>This is an example of a <strong>spline</strong>. The piecewise polynomials we constructed in the previous notebook are a generalisation of this idea of splines. While we saw that they provide an improvement for <em>Rungeâ€™s phenomenon</em>, the lack of smoothness due to potential discontinuities in the derivatives at the knots can create significant errors, as we will see.</p>
</section>
<section id="splines-general-definition">
<h2>Splines: General Definition<a class="headerlink" href="#splines-general-definition" title="Permalink to this headline">#</a></h2>
<p>In general, such a piecewise function forming a spline of degree <span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(S_m\)</span> say, is defined as follows:</p>
<p>Let <span class="math notranslate nohighlight">\([a,b]\)</span> be partitioned into sub-intervals <span class="math notranslate nohighlight">\([x_{k-1},x_k]\)</span>, <span class="math notranslate nohighlight">\(1 \le k \le n\)</span>, where <span class="math notranslate nohighlight">\(a=x_0 &lt; x_1 &lt; \dots &lt; x_n=b\,\)</span>. A spline <span class="math notranslate nohighlight">\(S_m\)</span> of degree <span class="math notranslate nohighlight">\(m\)</span> in <span class="math notranslate nohighlight">\([a,b]\)</span> satisfies the following properties:</p>
<p><span class="math notranslate nohighlight">\(\hspace{.5cm}\)</span> (i) <span class="math notranslate nohighlight">\(S_m \in P_m\,\)</span>: <span class="math notranslate nohighlight">\(S_m\)</span> restricted to <span class="math notranslate nohighlight">\([x_{k-1},x_k]\)</span> is a polynomial of degree at most <span class="math notranslate nohighlight">\(m \ge 1\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\hspace{.5cm}\)</span> (ii) <span class="math notranslate nohighlight">\(S_m \in C^{m-1}[a,b]\,\)</span>: the <span class="math notranslate nohighlight">\((m-1)\)</span>th derivatives are continuous.</p>
<p>Thus, for a given partition of <span class="math notranslate nohighlight">\([a,b]\)</span>, the spline consists of <span class="math notranslate nohighlight">\(n\)</span> <span class="math notranslate nohighlight">\(m\)</span>-degree polynomial segments with the appropriate continuity condition at each of the interior knots. This will ensure that the spline has a certain degree of <em>smoothness</em>.</p>
</section>
<section id="cubic-splines">
<h2>Cubic Splines<a class="headerlink" href="#cubic-splines" title="Permalink to this headline">#</a></h2>
<p>We consider the most commonly used spline, <em>the cubic spline</em>, when <span class="math notranslate nohighlight">\(m=3\)</span>.</p>
<p>Given <span class="math notranslate nohighlight">\((n+1)\)</span> points, <span class="math notranslate nohighlight">\(x_0,x_1,\dots,x_n\)</span>, which are equally spaced, we wish to construct a piecewise cubic <span class="math notranslate nohighlight">\(S_3(x)\)</span> such that</p>
<div class="math notranslate nohighlight">
\[S_3(x_k) = f(x_k), \qquad k=0,1,\dots,n\,,\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ S_3(x) \in C^2[x_0,x_n]\,,\]</div>
<p>i.e. <span class="math notranslate nohighlight">\(S_3(x)\)</span> is continuous and has continuous 1st and 2nd derivatives for <span class="math notranslate nohighlight">\( x_0 &lt; x &lt; x_n\)</span> (at the interior knots).</p>
<p><strong>Can this be done??</strong></p>
<p>A typical cubic has 4 unknowns (<span class="math notranslate nohighlight">\(ax^3+bx^2+cx+d\)</span>). We have <span class="math notranslate nohighlight">\(n\)</span> intervals so there are <span class="math notranslate nohighlight">\(n\)</span> cubics to be constructed, i.e. <span class="math notranslate nohighlight">\(4n\)</span> <u>unknowns</u>.</p>
<p>When fitting the data points, there are 2 values of <span class="math notranslate nohighlight">\(f(x)\)</span> for each sub-interval, and <span class="math notranslate nohighlight">\(n\)</span> intervals, so a total of <span class="math notranslate nohighlight">\(2n\)</span> <u>conditions</u>.</p>
<p>There are <span class="math notranslate nohighlight">\((n-1)\)</span> interval data points, <span class="math notranslate nohighlight">\(x_1,x_2,\dots,x_{n-1}\)</span>, so to ensure that <span class="math notranslate nohighlight">\(S'(x)\)</span> is continuous we have <span class="math notranslate nohighlight">\((n-1)\)</span> <u>conditions</u>.</p>
<p>Likewise, to ensure <span class="math notranslate nohighlight">\(S''(x)\)</span> is continuous we have a further <span class="math notranslate nohighlight">\((n-1)\)</span> <u>conditions</u>.</p>
<p>Hence, a total number of <span class="math notranslate nohighlight">\(4n-2\)</span> <u>conditions</u>. We are 2 short!</p>
<p>The two further conditions can be found in several ways:</p>
<ul class="simple">
<li><p><u>Case (i):</u> If we know <span class="math notranslate nohighlight">\(f'(x_0)\)</span> and <span class="math notranslate nohighlight">\(f'(x_n)\)</span> we could use these to provide 2 further conditions.</p></li>
<li><p><u>Case (ii):</u> We could estimate <span class="math notranslate nohighlight">\(f'(x_0)\)</span> and <span class="math notranslate nohighlight">\(f'(x_n)\)</span> from the values of <span class="math notranslate nohighlight">\(f(x_k)\)</span> and use these estimates.</p></li>
<li><p><u>Case (iii):</u> We could impose the condition that <span class="math notranslate nohighlight">\(S''(x_0) \equiv 0\)</span> and <span class="math notranslate nohighlight">\(S''(x_n) \equiv 0\)</span>. A spline constructed in this way is called a <em>natural spline</em>.</p></li>
</ul>
<p><strong>How do we construct <span class="math notranslate nohighlight">\(S_3(x)\)</span>?</strong></p>
<p>With <span class="math notranslate nohighlight">\(n\)</span> cubics, <span class="math notranslate nohighlight">\(4n\)</span> unknowns and <span class="math notranslate nohighlight">\(4n\)</span> equations, the whole exercise looks horrendous!</p>
<p>One of the easiest ways to do this is to define a basis for the cubic spline similar to the basis of the linear spline.</p>
<section id="the-basis-approach">
<h3>The basis approach<a class="headerlink" href="#the-basis-approach" title="Permalink to this headline">#</a></h3>
<p>Given a set of <span class="math notranslate nohighlight">\((n+1)\)</span> uniformly spaced data points (<span class="math notranslate nohighlight">\(n\)</span> equal sub-intervals), then a cubic spline is given by</p>
<div class="math notranslate nohighlight">
\[
S_3(x)=\sum_{k=-1}^{n+1}a_kB_k(x)\,,\]</div>
<p>where <span class="math notranslate nohighlight">\(B_k(x)\)</span> is the <em>basis</em> of the cubic spline.</p>
<p>Let the <span class="math notranslate nohighlight">\((n+1)\)</span> knots be <span class="math notranslate nohighlight">\(x_0,x_1,\dots,x_n\)</span> and assume that these knots are uniformly spaced at intervals of <span class="math notranslate nohighlight">\(h=1\)</span> with <span class="math notranslate nohighlight">\(x_0=0\)</span>, for simplicity (this assumption will be relaxed later so we can consider more general cases). Thus, <span class="math notranslate nohighlight">\(x_k = k\)</span>.</p>
<p><strong>The Cubic B-Spline <span class="math notranslate nohighlight">\({B_0(x)}\)</span></strong> is defined as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
B_0(x) &amp; = 0, \qquad x \le -2 \,, \\
B_0(x) &amp; = \frac{1}{6}(2+x)^3, \qquad -2 \le x \le -1 \,,\\
B_0(x) &amp; = \frac{2}{3}-\frac{1}{2}x^2(2+x),\qquad -1 \le x \le 0 \,,\\
B_0(x) &amp; = \frac{2}{3}-\frac{1}{2}x^2(2-x),\qquad 0 \le x \le 1 \,,\\
B_0(x) &amp; = \frac{1}{6}(2-x)^3, \qquad 1 \le x \le 2 \,,\\
B_0(x) &amp; = 0, \qquad x \ge 2 \,,
\end{align*}\]</div>
<p>Note, that at the knots <span class="math notranslate nohighlight">\(x_k = 0,\;\pm 1\)</span> and <span class="math notranslate nohighlight">\(\pm 2\)</span></p>
<div class="math notranslate nohighlight">
\[
 B_0(0)=\frac{2}{3}, \;\; B_0(\pm 1)=\frac{1}{6}, \;\; B_0(\pm2)=0\,.
 \]</div>
<div class="math notranslate nohighlight">
\[
B'_0(0)=0, \;\; B'_0(\pm 1)=\mp\frac{1}{2}, \;\; B'_0(\pm2)=0\,.
\]</div>
<div class="math notranslate nohighlight">
\[
B''_0(0)=-2, \;\; B''_0(\pm 1)= 1, \;\; B''_0(\pm2)=0\,.
\]</div>
<p><span class="math notranslate nohighlight">\(B_0(x)\)</span> is an example of a cubic spline. It is simple to show that <span class="math notranslate nohighlight">\(B'_0(x)\)</span> and <span class="math notranslate nohighlight">\(B''_0(x)\)</span> are continuous.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the B given the points -1,-2,0,1,2</span>
<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span>
<span class="n">x1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>
<span class="n">x2</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">x3</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">x4</span> <span class="o">=</span> <span class="mf">2.</span>

<span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="c1">#np.zeros_like(x)</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x0</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x1</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x2</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x3</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">i4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x3</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[:]</span><span class="o">&lt;=</span><span class="n">x4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i1</span><span class="p">[:]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="n">i1</span><span class="p">[:]])</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">6.</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i2</span><span class="p">[:]]</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i2</span><span class="p">[:]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="n">i2</span><span class="p">[:]])</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i3</span><span class="p">[:]]</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i3</span><span class="p">[:]]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i3</span><span class="p">[:]])</span>
    <span class="n">y</span><span class="p">[</span><span class="n">i4</span><span class="p">[:]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i4</span><span class="p">[:]])</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">6.</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="n">knots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">])</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">knots</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">knots</span><span class="p">),</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$B_0$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Interpolation_Part4_CubicSpline_4_0.png" src="../_images/Interpolation_Part4_CubicSpline_4_0.png" />
</div>
</div>
<p>In general, <span class="math notranslate nohighlight">\(B_k(x)\)</span> is defined as <span class="math notranslate nohighlight">\(B_0(x-k)\)</span>.</p>
<p>A linear combination of such functions will be continuous on <span class="math notranslate nohighlight">\(C^2[0,1]\)</span>, so they will automatically fulfill <span class="math notranslate nohighlight">\((n-1)\times 3 = 3n -3\)</span> of the <span class="math notranslate nohighlight">\(4n\)</span> conditions. Hence, another <span class="math notranslate nohighlight">\(4n-(3n-3)=n+3\)</span> conditions are required.</p>
<p>Now consider the function <span class="math notranslate nohighlight">\(S_3(x)\)</span> on the points, <span class="math notranslate nohighlight">\(0,1,\dots,n\)</span>,</p>
<div class="math notranslate nohighlight">
\[
S_3(x)=\sum_{k=-1}^{n+1} a_k B_k(x)\,, \qquad(1)
\]</div>
<p>which represents a linear combination of <span class="math notranslate nohighlight">\((n+3)\)</span> functions with the prescribed continuities.</p>
<ul class="simple">
<li><p>Consider an interval, <span class="math notranslate nohighlight">\([0,1]\)</span> say, this interval has contributions from 4 basis functions <span class="math notranslate nohighlight">\(B_{-1},\, B_0,\, B_1,\, B_2\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$B_{-1}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$B_0$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$B_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">phi</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$B_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$B$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Interpolation_Part4_CubicSpline_6_0.png" src="../_images/Interpolation_Part4_CubicSpline_6_0.png" />
</div>
</div>
<p>Similarly, the general interval <span class="math notranslate nohighlight">\([x_i,x_{i+1}]\)</span> has non-zero contributions from <span class="math notranslate nohighlight">\(B_{i-1}\)</span>, <span class="math notranslate nohighlight">\(B_{i}\)</span>, <span class="math notranslate nohighlight">\(B_{i+1}\)</span> and <span class="math notranslate nohighlight">\(B_{i+2}\)</span>, thus</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
S_3(x) &amp; = a_{k-1}B_{k-1}(x)+a_{k}B_{k}(x)+a_{k+1}B_{k+1}(x)+a_{k+2}B_{k+2}(x)\\&amp; =a_{k-1}B_{0}(x-k+1)+a_{k}B_{0}(x-k)+a_{k+1}B_{0}(x-k-1)+a_{k+2}B_{0}(x-k-2)\,.
\end{align*}\]</div>
<p>At the knots, <span class="math notranslate nohighlight">\(x_k=k\)</span>, our cubic spline must equal the values <span class="math notranslate nohighlight">\(f(x_k)\)</span>. Hence, we require</p>
<div class="math notranslate nohighlight">
\[
S_3(x_k)=f(x_k)=f(k)\,.
\]</div>
<p>So,</p>
<div class="math notranslate nohighlight">
\[
S_3(k)=a_{k-1}B_{0}(1)+a_{k}B_{0}(0)+a_{k+1}B_{0}(-1)+a_{k+2}B_{0}(-2)
 = f(k)=f(x_k)\,,
\]</div>
<p>which gives</p>
<div class="math notranslate nohighlight">
\[
f(x_k)=f(k)=\frac{1}{6}a_{k-1}+\frac{2}{3}a_{k}+\frac{1}{6}a_{k+1}+0\,,
\]</div>
<p>and thus,</p>
<div class="math notranslate nohighlight">
\[
a_{k+1}+4a_{k}+a_{k-1}=6f(x_k),\qquad x_k=k\,.
\]</div>
<p>We have <span class="math notranslate nohighlight">\((n+3)\)</span> unknowns, <span class="math notranslate nohighlight">\(a_{-1},a_{0},\dots,a_{n+1}\)</span> and <span class="math notranslate nohighlight">\((n+1)\)</span> data points <span class="math notranslate nohighlight">\(\left(x_k,f(x_k)\right)\)</span>, <span class="math notranslate nohighlight">\(k=0,1,\dots,n\)</span>.</p>
<p>Thus, we require <u>2 extra conditions</u> to find all <span class="math notranslate nohighlight">\(a_k\)</span>â€™s.</p>
<p>Suppose we insist that <span class="math notranslate nohighlight">\(S''_3(0)=0\)</span> as one extra condition:</p>
<div class="math notranslate nohighlight">
\[
(k=0) \qquad a_{-1}B''_{-1}(0)+a_{0}B''_{0}(0)+a_{1}B''_{1}(0)+a_{2}B''_{2}(0)=0\,,
\]</div>
<p>and hence,</p>
<div class="math notranslate nohighlight">
\[ a_{-1}B''_{0}(1)+a_{0}B''_{0}(0)+a_{1}B''_{0}(-1)+a_{2}B''_{0}(-2)=0\,,\]</div>
<p>or,</p>
<div class="math notranslate nohighlight">
\[ a_{-1}\times(1) + a_{0}\times(-2)+ a_{1}\times(1) + 0 =0\,,\]</div>
<p>so</p>
<div class="math notranslate nohighlight">
\[
    a_{-1}=2a_{0}-a_{1}\,,\]</div>
<p>and,</p>
<div class="math notranslate nohighlight">
\[a_{-1}+4a_{0}+a_{1}=6f(x_0)=6f(0)\,,\]</div>
<p>so</p>
<div class="math notranslate nohighlight">
\[
6a_0=6f(0)\,.
\]</div>
<p>We can produce a similar equation by requiring that</p>
<div class="math notranslate nohighlight">
\[ S''_3(n)=0\,,\]</div>
<p>which gives us</p>
<div class="math notranslate nohighlight">
\[ a_{n-1}-2a_{n}+a_{n+1}=0\quad\Rightarrow\quad a_{n+1}=2a_{n}-a_{n-1}\,,\]</div>
<p>and hence,</p>
<div class="math notranslate nohighlight">
\[ 6a_n=6f(n)\,.\]</div>
<p>For a <u>natural spline</u> we have the following system of equations</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp; a_0=f(0) \\
&amp; a_0 + 4 a_1 + a_2 = 6 f(1) \\
&amp; \dots \\
&amp; a_{n-2} + 4 a_{n-1} + a_n = 6 f(n-1) \\
&amp; a_n = f(n)\,.
\end{align*}\]</div>
<p>Or, in matrix form:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\begin{bmatrix} 
1      &amp; 0 &amp; 0     &amp; \dots &amp;   &amp; \dots &amp; 0      \\ 
1      &amp; 4 &amp; 1     &amp; 0     &amp;   &amp; \dots &amp; \vdots \\
0      &amp; 1 &amp; 4     &amp; 1     &amp; 0 &amp; \dots &amp; 0      \\
\vdots &amp;   &amp;       &amp;       &amp;   &amp;       &amp; \vdots \\
\vdots &amp;   &amp; \dots &amp; 0     &amp; 1 &amp; 4     &amp; 1      \\
0      &amp;   &amp; \dots &amp;       &amp; 0 &amp; 0     &amp; 1   
\end{bmatrix}
\begin{bmatrix}
a_0 \\
a_1 \\
\vdots \\
\vdots \\
a_{n-1} \\
a_n
\end{bmatrix}
=
\begin{bmatrix}
f(0) \\
6 f(1)\\
\vdots \\
\vdots \\
6 f(n-1) \\
f(n)
\end{bmatrix}
\end{align*}\]</div>
<p>This is a linear system of <span class="math notranslate nohighlight">\((n+1)\)</span> equations which we can solve to find the <span class="math notranslate nohighlight">\((n+1)\)</span> unknowns <span class="math notranslate nohighlight">\(a_k\)</span>, <span class="math notranslate nohighlight">\(k=0,\dots,n\)</span>. The constants <span class="math notranslate nohighlight">\(a_{-1}\)</span> and <span class="math notranslate nohighlight">\(a_{n+1}\)</span> can then be found (<span class="math notranslate nohighlight">\(a_{-1}=2a_{0}-a_{1}\)</span> and <span class="math notranslate nohighlight">\(a_{n+1}=2a_{n}-a_{n-1}\)</span>).</p>
<p>Finally, once we know all the <span class="math notranslate nohighlight">\(a_k\)</span>, the full spline <span class="math notranslate nohighlight">\(S_3(x)\)</span> can be obtained from equation (1).</p>
</section>
<section id="general-cubic-spline">
<h3>General Cubic Spline<a class="headerlink" href="#general-cubic-spline" title="Permalink to this headline">#</a></h3>
<p>In the previous section, we considered the cubic spline fitted to a set of <span class="math notranslate nohighlight">\(n+1\)</span> data points uniformly distributed on <span class="math notranslate nohighlight">\([0,n]\)</span> i.e. the data points had an interval of 1 such that <span class="math notranslate nohighlight">\(x_k=k\)</span>, <span class="math notranslate nohighlight">\(k=0,\dots,n\)</span>. However, in general, data points are unlikely to be spaced in such a manner.</p>
<p>Cubic splines are relatively simple on uniformly spaced data points and so we consider the case of <span class="math notranslate nohighlight">\(n+1\)</span> data points uniformally spaced with an interval of <span class="math notranslate nohighlight">\(h\)</span> over the range <span class="math notranslate nohighlight">\([a,b]\)</span>. Hence <span class="math notranslate nohighlight">\(x_k = a+kh\)</span> and <span class="math notranslate nohighlight">\(h = (b-a)/n\)</span></p>
<p>The basis for the cubic B-Spline then becomes</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
B_0(x) &amp; = 0, \qquad x-a \le -2h \,, \\
B_0(x) &amp; = \frac{1}{6}(2h+(x-a))^3, \qquad -2h \le x-a \le -h \,,\\
B_0(x) &amp; = \frac{2h^3}{3}-\frac{1}{2}(x-a)^2(2h+(x-a)),\qquad -h \le x-a \le 0 \,,\\
B_0(x) &amp; = \frac{2h^3}{3}-\frac{1}{2}(x-a)^2(2h-(x-a)),\qquad 0 \le x-a \le h \,,\\
B_0(x) &amp; = \frac{1}{6}(2h-(x-a))^3, \qquad h \le x-a \le 2h \,,\\
B_0(x) &amp; = 0, \qquad x-a \ge 2h \,,
\end{align*}\]</div>
<p>The overall cubic spline is still equal to $<span class="math notranslate nohighlight">\(S_3(x)=\sum_{k=-1}^{n+1} a_k B_k(x)\,,\)</span><span class="math notranslate nohighlight">\( 
with \)</span>B_k(x) = B_0(x-kh)<span class="math notranslate nohighlight">\( and the \)</span>a_k;,<span class="math notranslate nohighlight">\( \)</span>k=-1,\dots,n+1$ given by</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp; a_0= \frac{1}{h^3}f(x_0) \\
&amp; a_0 + 4 a_1 + a_2 = \frac{6}{h^3} f(x_1) \\
&amp; \dots \\
&amp; a_{n-2} + 4 a_{n-1} + a_n = \frac{6}{h^3} f(x_{n-1}) \\
&amp; a_n = \frac{1}{h^3} f(x_n)\,.
\end{align*}\]</div>
<p>with, in the natural spline case,
$<span class="math notranslate nohighlight">\(a_{-1}=2a_{0}-a_{1}\quad{\rm and}\quad a_{n+1}=2a_{n}-a_{n-1}\,.\)</span>$</p>
</section>
<section id="application">
<h3>Application<a class="headerlink" href="#application" title="Permalink to this headline">#</a></h3>
<p>Arguably the structure of the B-spline code with basis functions is a little more obvious than the piecewise polynomial code from the previous notebook. The implementation requires:</p>
<ul class="simple">
<li><p>A function defining the basis functions <span class="math notranslate nohighlight">\(B_k,\)</span></p></li>
<li><p>Setting up the tridiagonal matrix and right hand side vector, given the number of knots <span class="math notranslate nohighlight">\(n+1.\)</span></p></li>
<li><p>Solving this linear system to obtain <span class="math notranslate nohighlight">\(a_0,\,a_1,\,\dots,\,a_n,\)</span></p></li>
<li><p>Compute <span class="math notranslate nohighlight">\(a_{-1}\)</span> and <span class="math notranslate nohighlight">\(a_{n+1},\)</span></p></li>
<li><p>For each new evaluation point sum the contributions from each of the four <span class="math notranslate nohighlight">\(B_k\)</span> basis functions which have the point inside of their support,</p></li>
<li><p>DONE!</p></li>
</ul>
<p>Below we show this implemented and demonstrate its advantage over the regular piecewise cubic interpolation for the Rungeâ€™s function example of the previous notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the basis function, B_k(x)</span>
<span class="k">def</span> <span class="nf">Bspl</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>         <span class="c1"># assumes evenly spaced data</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">h</span>        <span class="c1"># following the formulae above set xx = x-xk = x-a-kh</span>
    <span class="k">if</span><span class="p">(</span><span class="n">xx</span><span class="o">&lt;-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span> <span class="ow">or</span> <span class="n">xx</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">xx</span><span class="o">&gt;=-</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span> <span class="ow">and</span> <span class="n">xx</span><span class="o">&lt;=-</span><span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="n">xx</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">6.</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">xx</span><span class="o">&gt;-</span><span class="n">h</span> <span class="ow">and</span> <span class="n">xx</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">xx</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="n">xx</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">xx</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">xx</span><span class="o">&lt;=</span><span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">xx</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="n">xx</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">xx</span><span class="o">&gt;=</span><span class="n">h</span> <span class="ow">and</span> <span class="n">xx</span><span class="o">&lt;=</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="o">-</span><span class="n">xx</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mf">6.</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="c1"># Runge&#39;s function for testing</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">25</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
<span class="c1"># Interval of interest</span>
<span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># set the knots</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># get the knot spacing</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># set the new evaluation points</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="c1">#----------------------------------------------------------------</span>
<span class="c1"># No loops are required here but we need to set up the matrix A:</span>

<span class="n">ik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>            <span class="c1"># use this array of integers to set diagonals</span>
<span class="n">matA</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>           <span class="c1"># set up matrix as 4*identity and then...</span>
<span class="n">matA</span><span class="p">[</span><span class="n">ik</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span><span class="p">],</span><span class="n">ik</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set lower diagonal</span>
<span class="n">matA</span><span class="p">[</span><span class="n">ik</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ik</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># set upper diagonal </span>

<span class="c1"># First and last rows for natural spline</span>
<span class="n">matA</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>                
<span class="n">matA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">matA</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">matA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


<span class="n">vecb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="c1"># set up RHS vector b</span>
<span class="n">vecb</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[:]</span><span class="o">/</span><span class="n">h</span><span class="o">**</span><span class="mi">3</span>
<span class="n">vecb</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">6.0</span>       <span class="c1"># first entry</span>

<span class="c1">#----------------------------------------------------------------</span>
<span class="c1"># Now we can solve the system Ax=b using numpy:</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">matA</span><span class="p">,</span><span class="n">vecb</span><span class="p">)</span>  
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>     <span class="c1"># insert the -1 coefficient</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">M</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">M</span><span class="p">]</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># insert the n+1 coefficient</span>


<span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>                 <span class="c1"># Loop the new points</span>
    <span class="n">jj</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">h</span><span class="p">)</span>       <span class="c1"># Find the subinterval k</span>
    <span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">x0</span><span class="p">[</span><span class="n">jj</span><span class="p">]):</span>              <span class="c1"># If evaluation point is a knot...</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>             <span class="c1"># use the knot</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>          <span class="c1"># Loop the 4 basis functions</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">jj</span><span class="o">+</span><span class="n">j</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Bspl</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x0</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>   <span class="c1"># accumulate contributions</span>
        

<span class="c1"># Do piecewise (non-Spline) interpolation for comparison</span>
<span class="c1">#------------------------------------------------------------</span>
<span class="c1"># Code from previous notebook</span>
<span class="n">Ndeg</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">nPoly</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">Ndeg</span>
<span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ndeg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nPoly</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPoly</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> 
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ndeg</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nPoly</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPoly</span><span class="p">):</span> <span class="c1"># for each poly solve the vandermode system</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vander</span><span class="p">(</span><span class="n">x0</span><span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">,:]])</span>
    <span class="n">a</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">y0</span><span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">,:]])</span>

<span class="n">pows</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ndeg</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ndeg</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="c1"># loop over the new points </span>

    <span class="k">if</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">x0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">M</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">x0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">|</span> <span class="p">((</span><span class="n">x0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">==</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="n">x0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">j</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">Ndeg</span><span class="o">//</span><span class="mi">2</span>     
    <span class="n">j</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">nPoly</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="n">pows</span><span class="p">)</span>
        
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Make the plot bigger than default to stop things getting cramped</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>        <span class="c1"># 1 row, 2 columns, first plot</span>

<span class="c1"># same plot as before, some options are a bit different</span>
<span class="c1">#------------------------------------------------------------</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">)</span>           
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="s1">&#39;kx&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sampled data&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ff</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;spline interpolated data&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non-spline interpolated data&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="c1"># now we use the &quot;ax.set_ &quot; version of the commands</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Polynomial interpolation&#39;</span><span class="p">)</span>
<span class="c1">#------------------------------------------------------------</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span> <span class="c1"># 1 row, 2 columns, first plot</span>

<span class="c1"># similar plots as before, some options are a bit different</span>
<span class="c1">#------------------------------------------------------------</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ff</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;spline interpolated data&#39;</span><span class="p">)</span>   
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;non-spline interpolated data&#39;</span><span class="p">)</span>   
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span> <span class="c1"># now we use the &quot;ax.set_ &quot; version of the commands</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p_</span><span class="si">{10}</span><span class="s1">(x)-f(x)$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error in interpolant&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#------------------------------------------------------------</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> <span class="c1"># this spaces the plots nicely</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Interpolation_Part4_CubicSpline_8_0.png" src="../_images/Interpolation_Part4_CubicSpline_8_0.png" />
</div>
</div>
<section id="scipy-implementation">
<h4><code class="docutils literal notranslate"><span class="pre">scipy</span></code> implementation<a class="headerlink" href="#scipy-implementation" title="Permalink to this headline">#</a></h4>
<p>As with many examples in numerical analysis, common methods like cubic splines are implemented in common Python modules. In this case the <code class="docutils literal notranslate"><span class="pre">scipy.interpolate</span></code> module has the function <code class="docutils literal notranslate"><span class="pre">CubicSpline</span></code> which takes the knots, the boundary condition (e.g. <em>natural</em>), and returns the cubic spline function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>

<span class="n">cs</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span><span class="n">bc_type</span><span class="o">=</span><span class="s1">&#39;natural&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Make the plot bigger than default to stop things getting cramped</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>        <span class="c1"># 1 row, 2 columns, first plot</span>

<span class="c1"># same plot as before, some options are a bit different</span>
<span class="c1">#------------------------------------------------------------</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">)</span>           
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="s1">&#39;kx&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sampled data&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ff</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;our spline&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;scipy spline&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="c1"># now we use the &quot;ax.set_ &quot; version of the commands</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spline interpolation&#39;</span><span class="p">)</span>
<span class="c1">#------------------------------------------------------------</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span> <span class="c1"># 1 row, 2 columns, first plot</span>

<span class="c1"># similar plots as before, some options are a bit different</span>
<span class="c1">#------------------------------------------------------------</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ff</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;our spline&#39;</span><span class="p">)</span>   
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;scipy spline&#39;</span><span class="p">)</span>   
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span> <span class="c1"># now we use the &quot;ax.set_ &quot; version of the commands</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p_</span><span class="si">{10}</span><span class="s1">(x)-f(x)$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error in interpolant&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#------------------------------------------------------------</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> <span class="c1"># this spaces the plots nicely</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Interpolation_Part4_CubicSpline_10_0.png" src="../_images/Interpolation_Part4_CubicSpline_10_0.png" />
</div>
</div>
<p>Our implementation looks virtually identical to scipy, reassuring that we have the method correct. It is likely, however, that the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> version is better optimised than ours so is usually preferrable. It is not uncommon, however, for use cases to exist for which built in functions are not suited, so being able to build our own gives us a lot more flexibility.</p>
<p>Just to check, we can calculate the difference between our implementation and the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> version</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">ff</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.3306690738754696e-15
</pre></div>
</div>
</div>
</div>
<p>It is close to machine precision which indicates to us the only difference is floating point errors, likely due to the order of operations.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./3_AppliedNotebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Interpolation_Part3_PiecewisePolynomial.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Interpolation Part 3: Piecewise polynomial interpolation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../4_PureNotebooks/0intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 4 Pure Mathematics: Graph Theory</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dan Lucas, Finn Smith, Ben Swallow<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>